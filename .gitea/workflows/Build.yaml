name: Gitea Actions Demo

on:
  push:
    branches: [main]

jobs:
  deploy:
    steps:
      - name: Get Zip
        run: |
          ZIP=https://install.service-now.com/glide/distribution/builds/package/app-signed/mid-linux-container-recipe/2022/09/16/mid-linux-container-recipe.tokyo-07-08-2022__patch1-09-01-2022_09-16-2022_1610.linux.x86-64.zip
          buildver=$(echo $ZIP | sed 's/^.*container-recipe.\(.*\).linux.*zip$/\1/')
          repo=gitea.kanis.dev
          echo "Downloading $buildver"
          wget -c $ZIP -O ./build.zip
          unzip -o ./build.zip
          rm ./build.zip
          docker buildx build --build-arg version=$buildver -t $repo/${{ gitea.repository }}:$buildver -t $repo/${{ gitea.repository }}:latest --platform linux/amd64 --push .